### 血与泪

### 调试过程中遇到的问题

1. 首先要改造调用bios 0x13中断来读取更多的扇区数，这里就要不断修改磁头号，磁道号来读取下18个扇区的内容[bios int 0x13](https://blog.csdn.net/zxl3901/article/details/50072539)
2. 把读取后的数据放在0x10000开始的内存中，每读18个扇区es 要增加0x240 因为 (0x240 << 4) = 0x2400 = 18*512
3. ~~如果读入的扇区数过多会读入到0xb0000~0xb2000中，这里是显存地址，会冲调奇数字节调属性，所以要调整write_char函数在写入显存时也要强制写入属性~~
4. 实际上我们读入的数据不能超过0xA0000，这里已经是显示缓冲区了（见《linux内核完全剖析》18页图)，所以我最多循环63次
5. 是什么提醒我去查看内存分布的：
    由于一直不能把磁盘上的数据写入到接近1M的高地址处，所以去查看软盘控制器参数表，0x1E中断，地址是0x1E*4=0x78
    这里存放的4字节操作数，给lgs指令调用，高8位给gs，低8位给通用寄存器如si
    最终[gs:si]是磁盘参数表的地址
    发现这个地址是[0x0f00:efc7]=0xfefc7，是接近1M的高地址，提醒了我去看一下PC 1M以下的内存布局，发现这里是ROM BIOS映射区，我猜应该是没法写入的